---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import EmailCapture from '../components/EmailCapture.astro';
import { Image } from 'astro:assets';
import scottImg from '../images/scott-murray.jpg';

const destinations = await getCollection('destinations', (entry) => {
  return !entry.data.draft;
});

const regions = [
  {
    slug: 'front-range',
    name: 'Front Range',
    description: 'Denver, Boulder, Colorado Springs, and the urban corridor where craft breweries meet mountain trailheads.',
    gradient: 'from-[#0D7377] to-[#1A2332]',
  },
  {
    slug: 'ski-country',
    name: 'Ski Country',
    description: 'World-class resorts from Vail to Aspen -- powder days in winter, wildflower hikes in summer.',
    gradient: 'from-sky-600 to-[#0D7377]',
  },
  {
    slug: 'national-parks',
    name: 'National Parks',
    description: 'Rocky Mountain, Mesa Verde, Great Sand Dunes, and Black Canyon -- Colorado\'s crown jewels.',
    gradient: 'from-emerald-700 to-[#1A2332]',
  },
  {
    slug: 'western-slope',
    name: 'Western Slope',
    description: 'Hot springs, red rock canyons, and mountain towns where the pace slows down and the views open up.',
    gradient: 'from-[#E8654A] to-amber-700',
  },
];

const regionOrder: Record<string, number> = {
  'front-range': 0,
  'ski-country': 1,
  'national-parks': 2,
  'western-slope': 3,
};

const sortedDestinations = [...destinations].sort((a, b) => {
  const regionDiff = (regionOrder[a.data.region] ?? 99) - (regionOrder[b.data.region] ?? 99);
  if (regionDiff !== 0) return regionDiff;
  return a.data.title.localeCompare(b.data.title);
});
---

<BaseLayout
  title="Colorado Travel Guide"
  description="Honest, first-hand Colorado travel guide covering 20 destinations across the Front Range, Ski Country, National Parks, and Western Slope. By Scott."
  pageType="homepage"
>
  <!-- Hero -->
  <section class="relative bg-gradient-to-br from-[#1A2332] via-[#0D7377] to-[#1A2332] text-white overflow-hidden">
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-white rounded-full blur-3xl"></div>
      <div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-[#E8654A] rounded-full blur-3xl"></div>
    </div>
    <div class="relative max-w-5xl mx-auto px-6 py-24 md:py-36 text-center">
      <p class="text-[#E8654A] font-semibold tracking-widest uppercase text-sm mb-4">discovercolorado.info</p>
      <h1 class="font-serif text-4xl md:text-6xl lg:text-7xl font-bold leading-tight mb-6">
        Your Guide to the<br />Rocky Mountain State
      </h1>
      <p class="text-lg md:text-xl text-white/80 max-w-2xl mx-auto mb-10">
        20 destinations. 4 regions. Real tips from real trips -- no press junkets, no freebies.
        Just an honest look at what makes Colorado one of the best places on earth.
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <a
          href="#destinations"
          class="inline-block bg-[#E8654A] hover:bg-[#d4553b] text-white font-semibold px-8 py-3 rounded-lg transition-colors"
        >
          Explore Destinations
        </a>
        <a
          href="#regions"
          class="inline-block border border-white/30 hover:border-white/60 text-white font-semibold px-8 py-3 rounded-lg transition-colors"
        >
          Browse by Region
        </a>
      </div>
    </div>
  </section>

  <!-- Regions -->
  <section id="regions" class="bg-[#F5F0E8] py-16 md:py-24">
    <div class="max-w-6xl mx-auto px-6">
      <h2 class="font-serif text-3xl md:text-4xl text-[#1A2332] text-center mb-4">Four Regions, Endless Adventure</h2>
      <p class="text-center text-gray-600 max-w-2xl mx-auto mb-12">
        Colorado is bigger than most people realize. Each region has its own character, climate, and vibe.
      </p>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {regions.map((region) => {
          const count = destinations.filter(d => d.data.region === region.slug).length;
          return (
            <a
              href={`/regions/${region.slug}/`}
              class="group block rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-shadow bg-white"
            >
              <div class={`bg-gradient-to-br ${region.gradient} p-6 min-h-[120px] flex items-end`}>
                <h3 class="text-white font-serif text-xl font-bold group-hover:translate-x-1 transition-transform">
                  {region.name}
                </h3>
              </div>
              <div class="p-5">
                <p class="text-gray-600 text-sm leading-relaxed mb-3">{region.description}</p>
                <span class="text-[#0D7377] text-sm font-semibold">
                  {count} {count === 1 ? 'destination' : 'destinations'} &rarr;
                </span>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Destinations Grid -->
  <section id="destinations" class="bg-white py-16 md:py-24">
    <div class="max-w-6xl mx-auto px-6">
      <h2 class="font-serif text-3xl md:text-4xl text-[#1A2332] text-center mb-4">All Destinations</h2>
      <p class="text-center text-gray-600 max-w-2xl mx-auto mb-12">
        Every destination guide includes budget breakdowns, getting-there logistics, and the kind of honest tips you only get from someone who has actually been there.
      </p>
      {sortedDestinations.length > 0 ? (
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {sortedDestinations.map((dest) => {
            const slug = dest.slug || dest.id;
            const regionLabel = regions.find(r => r.slug === dest.data.region)?.name ?? dest.data.region;
            return (
              <a
                href={`/destinations/${slug}/`}
                class="group block rounded-2xl overflow-hidden shadow-sm hover:shadow-lg border border-gray-100 transition-all hover:-translate-y-1"
              >
                <div class={`bg-gradient-to-br ${dest.data.gradientColors || 'from-[#0D7377] to-[#1A2332]'} p-5 min-h-[100px] flex flex-col justify-end`}>
                  <span class="text-white/70 text-xs font-semibold uppercase tracking-wider">{regionLabel}</span>
                  <h3 class="text-white font-serif text-lg font-bold mt-1">{dest.data.title}</h3>
                </div>
                <div class="p-4">
                  <p class="text-gray-600 text-sm leading-relaxed line-clamp-2">
                    {dest.data.description || dest.data.tagline || 'Explore this Colorado destination.'}
                  </p>
                  {dest.data.budgetPerDay?.midRange > 0 && (
                    <p class="text-[#0D7377] text-xs font-semibold mt-3">
                      From ${dest.data.budgetPerDay.backpacker || dest.data.budgetPerDay.midRange}/day
                    </p>
                  )}
                </div>
              </a>
            );
          })}
        </div>
      ) : (
        <div class="text-center py-12 bg-[#F5F0E8] rounded-2xl">
          <p class="text-gray-500 text-lg">Destination guides are coming soon. Check back shortly.</p>
        </div>
      )}
    </div>
  </section>

  <!-- About / Trust -->
  <section class="bg-[#F5F0E8] py-16 md:py-24">
    <div class="max-w-4xl mx-auto px-6">
      <div class="flex flex-col md:flex-row items-center gap-10">
        <div class="shrink-0">
          <Image
            src={scottImg}
            alt="Scott Murray"
            width={160}
            height={160}
            class="rounded-full border-4 border-white shadow-lg"
          />
        </div>
        <div>
          <h2 class="font-serif text-3xl text-[#1A2332] mb-4">Hey, I'm Scott</h2>
          <p class="text-gray-700 leading-relaxed mb-4">
            I built Discover Colorado to share what I've learned from years of exploring this state --
            the ski towns, the craft beer scenes, the national parks, and the hidden-gem mountain towns
            that don't always make the guidebooks.
          </p>
          <p class="text-gray-700 leading-relaxed mb-4">
            Every destination on this site comes from my own trips. I pay my own way, I take my own photos,
            and I give you the honest take -- including when something isn't worth the hype.
          </p>
          <p class="text-gray-600 text-sm">
            Prices in USD. Last verified dates on every page. No sponsored content disguised as editorial.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Email Capture -->
  <section class="bg-white py-16 md:py-20">
    <div class="max-w-3xl mx-auto px-6">
      <EmailCapture
        leadMagnet="Free Colorado Travel Checklist"
        placement="inline"
        description="Get my Colorado packing list, budget planner, and seasonal tips -- all in one PDF. No spam, unsubscribe anytime."
        bullets={[
          'Altitude-adjusted packing checklist',
          'Budget breakdown for all 20 destinations',
          'Best times to visit each region',
          'Insider tips for saving on ski passes',
        ]}
        guideTag="homepage-checklist"
      />
    </div>
  </section>
</BaseLayout>
