---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allDests = await getCollection('destinations', (entry) => {
  return !entry.data.draft;
});

const regions: Record<string, typeof allDests> = {
  'front-range': [],
  'ski-country': [],
  'national-parks': [],
  'western-slope': [],
};
allDests.forEach((d) => {
  if (regions[d.data.region]) regions[d.data.region].push(d);
});
Object.values(regions).forEach((arr) =>
  arr.sort((a, b) => a.data.title.localeCompare(b.data.title))
);

const regionMeta: Record<string, { label: string; desc: string }> = {
  'front-range': {
    label: 'Front Range',
    desc: "Denver, Boulder, and Colorado's urban gateway to the Rockies",
  },
  'ski-country': {
    label: 'Ski Country',
    desc: 'World-class ski resorts and charming mountain towns',
  },
  'national-parks': {
    label: 'National Parks',
    desc: 'From ancient cliff dwellings to towering sand dunes',
  },
  'western-slope': {
    label: 'Western Slope',
    desc: 'Remote canyons, hot springs, and wine country',
  },
};

const regionOrder = ['front-range', 'ski-country', 'national-parks', 'western-slope'] as const;
---

<BaseLayout title="All Destinations">
  <!-- Hero -->
  <section class="bg-[#1A2332] py-20 px-6 text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-4">
      Explore Colorado
    </h1>
    <p class="text-lg text-white/70 max-w-xl mx-auto leading-relaxed">
      In-depth travel guides to Colorado's best destinations â€” from the Front Range to the Western Slope.
    </p>
  </section>

  <!-- Region sections -->
  {regionOrder.map((regionKey) => {
    const dests = regions[regionKey];
    const meta = regionMeta[regionKey];
    if (!dests || dests.length === 0) return null;
    return (
      <section class="py-14 px-6 max-w-5xl mx-auto">
        {/* Region header */}
        <div class="mb-8 border-l-4 border-[#0D7377] pl-5">
          <h2 class="text-2xl font-bold text-[#1A2332]">{meta.label}</h2>
          <p class="text-[#1A2332]/60 mt-1">{meta.desc}</p>
        </div>

        {/* Destination cards */}
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {dests.map((dest) => {
            const slug = dest.slug || dest.id;
            return (
              <a
                href={`/destinations/${slug}/`}
                class="block rounded-2xl border border-[#0D7377]/15 bg-[#F5F0E8] p-5 transition hover:-translate-y-1 hover:shadow-lg hover:border-[#0D7377]/40"
              >
                <h3 class="text-lg font-semibold text-[#1A2332]">
                  {dest.data.title}
                </h3>
                {dest.data.tagline && (
                  <p class="mt-1 text-sm text-[#1A2332]/60 leading-snug">
                    {dest.data.tagline}
                  </p>
                )}
              </a>
            );
          })}
        </div>
      </section>
    );
  })}
</BaseLayout>
